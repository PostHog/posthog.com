---
title: How we use the data warehouse at PostHog
date: 2025-07-14
featuredImage: >-
  https://res.cloudinary.com/dmukukwp6/image/upload/warehouse_blog_633055c72f.png
featuredImageType: full
author:
 - ian-vanagas
tags:
 - data warehouse
 - Product engineers
crosspost:
 - product-engineers
---

import ErrorTrackingChurn from './_snippets/error-tracking-churn.mdx'
import CaptureExceptions from './_snippets/capture-exceptions.mdx'
import SurveyGrowth from './_snippets/survey-growth.mdx'
import USEURevenue from './_snippets/us-eu-revenue.mdx'
import RevenueLifecycle from './_snippets/revenue-lifecycle.mdx'
import RevenuePerProduct from './_snippets/revenue-per-product.mdx'
import StartupPlanCustomerCount from './_snippets/startup-plan-customer-count.mdx'
import StartupRevenuePerCustomer from './_snippets/startup-revenue-per-customer.mdx'
import BreachedTickets from './_snippets/breached-tickets.mdx'
import EscalatedSLA from './_snippets/escalated-sla.mdx'
import TimeTicketsCreated from './_snippets/time-tickets-created.mdx'
import OpportunitiesPerQuarter from './_snippets/opportunities-per-quarter.mdx'
import PipelinePerQuarter from './_snippets/pipeline-per-quarter.mdx'
import ManagedAccounts from './_snippets/managed-accounts.mdx'

PostHog's [data warehouse](/data-warehouse) is arguably our most powerful feature. It lets you sync data from the tools you already use (like [Stripe](/docs/cdp/sources/stripe), [Salesforce](/docs/cdp/sources/salesforce), and [Hubspot](/docs/cdp/sources/hubspot)), query it alongside your existing product data using [SQL](/docs/data-warehouse/sql), and visualize it natively.

We built it because the [modern data stack sucks](/blog/modern-data-stack-sucks). What starts as a handful of business critical tools devolves into dozens of tools, many specifically built to capture, clean, format, load, query, and visualize data.

We knew it didn't have to be this way, so we built the data warehouse to get rid of all this complexity and give you a single source of truth for all your business data.

Our team is big fans of what we've built. As proof, we sync hundreds of millions of rows from Postgres, Stripe, Temporal, and more on top of the tens of millions of events we capture each day.

<ProductScreenshot
  imageLight="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_16_at_11_04_28_2x_905d242fe0.png"
  imageDark="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_16_at_11_04_02_2x_690da5bd8b.png"
  alt="PostHog data warehouse rows synced"
  classes="rounded"
/>

We've also created **over 1,600** SQL insights using our data warehouse. Each is a combination of an SQL query and a visualization. It's our second most popular type of insight behind trends (which was around long before we had the data warehouse).

<ProductScreenshot
  imageLight="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_10_at_11_47_15_2x_9b179c988a.png"
  imageDark="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_10_at_11_47_58_2x_19e2267c12.png"
  alt="PostHog SQL insights"
  classes="rounded"
/>

The downside of the data warehouse's power and flexibility is that it can be tricky to know where to start. To help you with this, we're going over how different teams at PostHog actually use the data warehouse from the sources they use to the actual SQL queries they write.

> **Modifying queries to your data:** Because our data structure is unique, the SQL queries included here likely won't work out-of-the-box for you. Luckily, [Max AI](/max) makes modifying SQL easy. Just paste these queries in as context and ask him to use your data instead.

## Understanding growth and churn

- Sources: [Postgres](/docs/cdp/sources/postgres), [PostHog](/docs/new-to-posthog/understand-posthog), [Salesforce](/docs/cdp/sources/salesforce)
- Tables: `postgres_invoice_with_annual_view`, `postgres_billing_customer`, `events`, `salesforce.contact`, `postgres.posthog_team`, `postgres.posthog_organization`, `postgres_billing_usagereport`

![Growth and churn](https://res.cloudinary.com/dmukukwp6/image/upload/growth_churn_61b9f808a7.png)

Product managers at PostHog [don't tell engineers what to do](/newsletter/product-management-is-broken). Instead, they do help them with analysis. SQL is often their weapon of choice to do this.

Core to this analysis is often combining product and revenue data, we don't only want to see how people are using a product but:

- Who churned, how much was their churn, and why? (so we can prevent future churn)
- Product-specific activation and retention rates, using our custom definition.
- Metrics for their growth reviews, like revenue expansion and contraction.

For all this, you might think we'd use our [Stripe source](/docs/cdp/sources/stripe), but you'd be wrong. Since we have multiple different products with different usage-based pricing, we need a custom billing service to handle everything. The data from this service goes into Postgres, which then gets synced and used in PostHog. 

<ProductScreenshot
  imageLight="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_01_at_13_39_25_2x_9cd97c333c.png"
  imageDark="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_01_at_13_40_29_2x_88ae2be58f.png"
  alt="PostHog"
  classes="rounded"
/>

### Using views

Because product managers are slicing and dicing the data in multiple similar ways, they end up using a lot of [views](/docs/data-warehouse/views). These enable them to reuse queries to build other ones. Some examples include:

- `org_icp_scores`: Gets ICP scores for customers from Salesforce where they are calculated.
- `feature_flags_activation_base`: Builds a funnel of product intent → activation → retention, all centered on [feature flags](/feature-flags) and enriched with an ICP score.
- `source_of_truth_for_dp_pricing_model`: Data on which customers are using [pipelines](/cdp), what volume they are doing, and more to help improve our data pipeline pricing.

### Sample queries

<details>
  <summary>Error tracking churn for June</summary>  
  <ErrorTrackingChurn />
</details>

<details>
  <summary>Organizations regularly capturing exceptions (monthly)</summary>
  <CaptureExceptions />
</details>

<details>
  <summary>Surveys usage growth rate over time</summary>
  <SurveyGrowth />
</details>

## Tracking revenue

- Sources: [Postgres](/docs/cdp/sources/postgres), [Salesforce](/docs/cdp/sources/salesforce)
- Tables: `postgres_invoice_with_annual_view`, `postgres_billing_customer`, `postgres_billing_usagereport`, `salesforce_opportunity`

![Revenue](https://res.cloudinary.com/dmukukwp6/image/upload/revenue_c11fd894d5.png)

As I hinted at above, tracking revenue at PostHog is complicated. We have multiple products with usage-based and tiered pricing with discounts and add-ons, so we can't just query Stripe and get our revenue data. We have a specific billing service that generates invoices and reports, and adds them to Postgres.

For multiple years, we used Metabase to query and visualize all this revenue data from Postgres. All of the cleanup and reformatting needed to make it usable was in there too. Moving all this to PostHog was a lot of work (it had its own project Slack channel), but we've done it now. 

Our PostHog revenue dashboard now includes insights on the following (powered by the data warehouse): 

- Monthly and annual recurring revenue over time
- Revenue lifecycle (new, retention, expansion, contraction)
- Customer size analysis
- Per-product revenue analysis

Rebuilding (and improving) these insights required us to build views that standardize the data, connect Salesforce to better project revenue, create SQL visualizations we were missing, and more. Overall, the project was a success both in terms of making our revenue data more accessible and improving our data warehouse as a product. 

### Sample queries

<details>
  <summary>US/EU revenue split</summary>
  <USEURevenue />
</details>

<details>
  <summary>Revenue lifecycle</summary>
  <RevenueLifecycle />
</details>

<details>
  <summary>Revenue per product</summary>
  <RevenuePerProduct />
</details>

## Tracking startup and YC plan growth, costs, and ROI

- Sources: [Stripe](/docs/cdp/sources/stripe), [Postgres](/docs/cdp/sources/postgres)
- Tables: `stripe_customer`, `stripe_invoice`, `postgres_billing_usagereport`, `postgres_billing_customer`

![Startup and YC](https://res.cloudinary.com/dmukukwp6/image/upload/startup_yc_375b27d761.png)

Each quarter, hundreds of startups sign up for our [startup plan](/startups) (which gives them $50k in free credits), dozens more sign up to our upgraded [YC plan](/handbook/brand/startups#posthog-for-y-combinator). To make sure it is going well, we have a dashboard with details like:

1. The number of organizations on the startup plan
2. The cost of the startup plan for us based on credit usage.
3. The count of startups who “graduate” and pay us money as well as how much money they pay us. 

Unlike the revenue, churn, and growth data, we actually do use Stripe for this. We have metadata on Stripe customers saying if they are a startup plan customer and what type of startup plan they are on. This helps us get the customer count as well as the “graduate” details.

Costs rely on combining the Stripe data with our billing data in Postgres. This lets us see how many credits startup plan customers are going through.

### Sample queries

<details>
  <summary>Startup plan customer count (not YC)</summary>
  <StartupPlanCustomerCount />

</details>

<details>
  <summary>Previous startup & YC plan customers revenue per customer</summary>
  <StartupRevenuePerCustomer />
</details>

<details>
  <summary>Startup & YC plan customers cohorts by starting month</summary>
  <StartupCohorts />
</details>

## Creating support reports (SLA, first response time, and more) 

- Sources: [Zendesk](/docs/cdp/sources/zendesk)
- Tables: `zendesk_ticket_events`, `zendesk_tickets`, `zendesk_ticket_metric_events`, `zendesk_groups`

![Support](https://res.cloudinary.com/dmukukwp6/image/upload/support_26663efc71.png)

We have high standards for our support experience. Where do those standards get judged? The data warehouse, of course. 

We used to do all our support reporting in Zendesk, but since we added the Zendesk source, doing it in PostHog has become easier and better. 

Unlike other teams, support almost always uses Zendesk exclusively. This means less complicated queries and more opportunities to use trend insights on top of SQL insights. 

For example, our **SLA Achievement Rate** insight looks at the `ticket_metrics_events` table from `zendesk` to find what percentage of tickets were replied to or updated within the [SLA goals we set out](/handbook/support/customer-support#response-targets-slas-and-csat-surveys) (no SQL required).

<ProductScreenshot
  imageLight="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_09_at_10_31_29_2x_5928b4166b.png"
  imageDark="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_09_at_10_31_48_2x_73f756a1b4.png"
  alt="PostHog"
  classes="rounded"
/>

Beyond this, they use both insight types to track:

- Service-level agreement (SLA) and first response time goals.
- Performance and breaches on escalated tickets.
- Support load on our product teams.
- Sources of support requests.

This data is combined with [CSAT surveys](/templates/csat-survey) (both scores and responses) to give a complete picture of the support we're providing at PostHog. Abigail writes up a summary based on this data and shares it with the exec team weekly. 

![Support report](https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_14_at_10_27_19_2x_5d1fdd9ef1.png)

### Sample queries

<details>
  <summary>Breached non-escalated tickets in the last 7 days</summary>
  <BreachedTickets />

</details>

<details>
  <summary>Escalated SLA % last 7 days by team</summary>
  <EscalatedSLA />
</details>

<details>
  <summary>Time UTC when tickets are created (last 6 months)</summary>
  <TimeTicketsCreated />
</details>

## Creating quarterly sales and customer success reports

- Sources: [Salesforce](/docs/cdp/sources/salesforce), [Postgres](/docs/cdp/sources/postgres), [Vitally](/docs/cdp/sources/vitally)
- Tables: `invoice_with_annual_plans_shifted`, `vitally_all_managed_accounts`, `salesforce_opportunity`, `salesforce_user`

![Sales and CS](https://res.cloudinary.com/dmukukwp6/image/upload/sales_9c2c3860b7.png)

Similar to support, sales does reporting through PostHog. They pull from Salesforce mostly, but also billing data in Postgres and account ownership details from Vitally. These are best combined in the **Sales and CS Quarter Tracker** dashboard which covers details like:

- Revenue from customers managed by sales and customer success
- Details on managed customers
- Salesforce opportunity pipeline and how much they're worth
- Won opportunities and how much they're worth

### Using variables

The sales dashboard is the best example of the power of [variables](/docs/data-warehouse/sql/variables). Nearly every insight uses variables to set the account owner, quarter, and whether they are managed by sales or customer success. 

This makes all of the insights much more reusable by being able to reuse them across quarters or for looking at individual performance. 

<ProductScreenshot
  imageLight="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_09_at_13_52_43_2x_d99d5c2158.png"
  imageDark="https://res.cloudinary.com/dmukukwp6/image/upload/Clean_Shot_2025_07_09_at_13_52_20_2x_a3d79b8b95.png"
  alt="PostHog"
  classes="rounded"
/>

### Sample queries

<details>
  <summary>Salesforce opportunities by quarter</summary>
  <OpportunitiesPerQuarter />
</details>

<details>
  <summary>Salesforce open pipeline by quarter (annual only)</summary>
  <PipelinePerQuarter />

</details>

<details>
  <summary>Sales and CS managed accounts start of quarter ARR</summary>
  <ManagedAccounts />
</details>

## How should you get started?

Feeling inspired? Here's how you can get started:

1. Start by [linking a source](/docs/cdp/sources) from a tool you already use.
2. Go to the [SQL editor](https://us.posthog.com/sql) and start by writing a basic query like `select * from events limit 10`.
3. Layer more complexity, like filtering, [aggregating](/docs/data-warehouse/sql/useful-functions#aggregate-functions), and [joining](/docs/data-warehouse/join) data. Use [Max AI](/max) to help you with this.
4. Use our [SQL visualizations](/docs/data-warehouse/query#sql-visualizations) to see your data in a new way.
5. Build a dashboard of related insights and share them with your team.
