---
title: Upload source maps for Next.js
---

import { CallToAction } from 'components/CallToAction'
import { Steps, Step } from 'components/Docs/Steps'

> By the end of this guide, you'll understand how to upload source maps for your framework and have proper stack traces in PostHog.
>
> <CallToAction type="primary" to="https://us.posthog.com/onboarding/error_tracking?step=source_maps">
>    Follow in PostHog
> </CallToAction>

<Steps>
<Step title="Install the PostHog Next.js config package" subtitle="Your goal in this step: Install the PostHog Next.js config package." badge="required">

  ```shell
  npm install @posthog/nextjs-config
  ```

</Step>
<Step title="Add PostHog config to your Next.js app" subtitle="Your goal in this step: Add PostHog config to your Next.js app." badge="required">

  Add the following to your `next.config.js` file:

  ```js file=next.config.js

  import { withPostHogConfig } from "@posthog/nextjs-config";

  const nextConfig = {
    //...your nextjs config,
  };

  export default withPostHogConfig(nextConfig, {
    personalApiKey: process.env.POSTHOG_API_KEY, // Personal API Key
    envId: process.env.POSTHOG_ENV_ID, // Environment ID
    host: process.env.NEXT_PUBLIC_POSTHOG_HOST, // (optional), defaults to https://us.posthog.com
    sourcemaps: { // (optional)
        enabled: true, // (optional) Enable sourcemaps generation and upload, default to true on production builds
        project: "my-application", // (optional) Project name, defaults to repository name
        version: "1.0.0", // (optional) Release version, defaults to current git commit
        deleteAfterUpload: true, // (optional) Delete sourcemaps after upload, defaults to true
    },
  });

  ```

  Where you should set the following environment variables:

  | Environment Variable | Description |
  | --- | --- |
  | `POSTHOG_API_KEY` | [Personal API key](https://app.posthog.com/settings/user-api-keys#variables) with at least `write` access on `error tracking` |
  | `POSTHOG_ENV_ID` | Project ID you can find in your [project settings](https://app.posthog.com/settings/environment#variables) |
  | `NEXT_PUBLIC_POSTHOG_HOST` | Your PostHog instance URL. Defaults to `https://us.posthog.com` |

</Step>

<Step checkpoint title="Verify source map generation" subtitle="Confirm source maps are being generated">

Before proceeding, confirm that source maps are being generated by checking for `.js.map` files in your `dist` directory. These are the symbol sets that will be used to unminify stack traces in PostHog.

</Step>

<Step title="Inject and upload source maps" subtitle="Your goal in this step: Automatically inject metadata during the build process." badge="required">
 
  The Next.js package automatically handles source map injection and upload during the build process. No additional configuration is needed.

  Make sure you serve the injected files in production by running the same build and inject process in CI during deployment. PostHog will need access to these injected `chunkId` comments when building the stack traces.

</Step>

<Step checkpoint title="Verify source map upload and injection" subtitle="Confirm source maps are properly uploaded and injected">

Before proceeding:

1. Confirm that source maps are successfully uploaded to PostHog. 

<div className="mt-4 mb-2">

<CallToAction type="primary" to="https://us.posthog.com/settings/project-error-tracking#error-tracking-symbol-sets">
    Check symbol sets in PostHog
</CallToAction>

</div>

2. Confirm that the served files are injected with the correct source map comment in production in dev tools:

```js 
//# chunkId=0197e6db-9a73-7b91-9e80-4e1b7158db5c
``` 

</Step>
</Steps>