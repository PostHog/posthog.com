<CalloutBox icon="IconFlask" title="Support is in private alpha" type="info">

Support is currently in private alpha. [Request early access](https://us.posthog.com/settings/user-feature-previews#in-app-messenger) and we'll invite you when ready.

</CalloutBox>

This documents the HTTP API for the Support widget. Most users should use the [JavaScript SDK](/docs/support/javascript-api) instead, which handles authentication and session management automatically.

## Authentication

All widget API requests require the `X-Conversations-Token` header with your public token:

```bash
X-Conversations-Token: <your_public_token>
```

Find your public token in **Settings > Support** in PostHog.

## Base URL

```
/api/conversations/v1/widget/
```

## Endpoints

### POST /message

Create a new message. Creates a ticket if this is the first message for the widget session.

**Request body:**
```json
{
  "widget_session_id": "uuid",
  "distinct_id": "user_123",
  "message": "I need help with...",
  "traits": { "name": "John", "email": "john@example.com" },
  "session_id": "optional_posthog_session_id",
  "session_context": { "current_url": "https://..." }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `widget_session_id` | string | Yes | Unique browser identifier (UUID) |
| `message` | string | Yes | The message text |
| `distinct_id` | string | No | PostHog distinct_id for person linking |
| `traits` | object | No | User info: `name`, `email` |
| `session_id` | string | No | PostHog session ID for replay linking |
| `session_context` | object | No | Additional context: `current_url` |

**Response:**
```json
{
  "ticket_id": "uuid",
  "message_id": "uuid",
  "ticket_status": "new",
  "created_at": "2024-01-15T10:30:00Z",
  "unread_count": 0
}
```

### GET /messages/{ticket_id}

Fetch messages for a ticket.

**Query parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `widget_session_id` | string | Yes | Must match the ticket's session |
| `after` | string | No | ISO timestamp for pagination |
| `limit` | number | No | Max messages to return (default: 100, max: 500) |

**Response:**
```json
{
  "ticket_id": "uuid",
  "ticket_status": "open",
  "messages": [
    {
      "id": "uuid",
      "content": "Hello, I need help",
      "author_type": "customer",
      "created_at": "2024-01-15T10:30:00Z",
      "is_private": false
    }
  ],
  "has_more": false,
  "unread_count": 1
}
```

### GET /tickets

List tickets for a widget session.

**Query parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `widget_session_id` | string | Yes | Browser identifier |
| `status` | string | No | Filter by status |
| `limit` | number | No | Max tickets to return (default: 20) |
| `offset` | number | No | Pagination offset |

**Response:**
```json
{
  "count": 5,
  "results": [
    {
      "id": "uuid",
      "status": "open",
      "last_message": "Thanks for your help!",
      "last_message_at": "2024-01-15T10:30:00Z",
      "message_count": 3,
      "created_at": "2024-01-15T10:00:00Z",
      "unread_count": 1
    }
  ]
}
```

### POST /messages/{ticket_id}/read

Mark messages as read by the customer.

**Request body:**
```json
{
  "widget_session_id": "uuid"
}
```

**Response:**
```json
{
  "success": true,
  "unread_count": 0
}
```

## Security

### Origin validation

Requests are validated against the `allowed_domains` setting. If domains are configured, requests from other origins are rejected.

### Session-based access control

Users can only access tickets associated with their `widget_session_id`. This prevents users from viewing other people's conversations.

### Honeypot

A hidden `_hp` field rejects bot submissions if filled.

### Rate limiting

The API implements rate limiting:
- Per-user throttling based on widget_session_id
- Per-team throttling to prevent abuse

If rate limited, you'll receive a `429 Too Many Requests` response.

## Error responses

| Status | Description |
|--------|-------------|
| `400` | Bad request - missing required fields |
| `401` | Unauthorized - invalid or missing token |
| `403` | Forbidden - origin not allowed or session mismatch |
| `404` | Not found - ticket doesn't exist |
| `429` | Too many requests - rate limited |
| `500` | Server error |

Error responses include a JSON body:
```json
{
  "error": "Description of the error"
}
```
