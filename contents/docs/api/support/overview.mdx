---
title: Widget API
sidebar: Docs
showTitle: true
---

<CalloutBox icon="IconFlask" title="Support is in private alpha" type="info">

Support is currently in private alpha. [Share your thoughts](https://us.posthog.com/external_surveys/019af5f5-a50e-0000-b10f-e8c30c0b73a0) and we'll reach out with early access.

</CalloutBox>

The Widget API allows you to build custom support interfaces instead of using the default chat widget. This is a low-level HTTP API â€“ **most users should use the [JavaScript SDK](/docs/support/javascript-api) instead**, which handles authentication, session management, and provides a simpler interface.

## Base URL

```
/api/conversations/v1/widget/
```

## Authentication

All requests require the `X-Conversations-Token` header with your public token:

```
X-Conversations-Token: <public_token>
```

You can find your public token in **Settings > Conversations** in PostHog. This token is safe to expose in client-side code.

## Endpoints

### POST /message

Create a new message. If this is the first message for the `widget_session_id`, a new ticket is created.

**Request body:**

```json
{
  "widget_session_id": "uuid",
  "distinct_id": "user_123",
  "message": "I need help with...",
  "traits": { 
    "name": "John", 
    "email": "john@example.com" 
  },
  "session_id": "optional_posthog_session_id",
  "session_context": { 
    "current_url": "https://example.com/page" 
  }
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `widget_session_id` | string | Yes | Persistent UUID identifying this browser session |
| `distinct_id` | string | No | PostHog distinct_id for person linking |
| `message` | string | Yes | The message content |
| `traits` | object | No | User info: `name`, `email` |
| `session_id` | string | No | PostHog session ID for replay linking |
| `session_context` | object | No | Additional context: `current_url` |

**Response:**

```json
{
  "ticket_id": "uuid",
  "message_id": "uuid",
  "ticket_status": "new",
  "created_at": "2024-01-15T10:30:00Z",
  "unread_count": 0
}
```

### GET /messages/{ticket_id}

Fetch messages for a specific ticket.

**Query parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `widget_session_id` | string | Yes | Must match the ticket's session |
| `after` | string | No | ISO timestamp to fetch messages after (for polling) |
| `limit` | number | No | Max messages to return (default: 50, max: 500) |

**Response:**

```json
{
  "ticket_id": "uuid",
  "ticket_status": "open",
  "messages": [
    {
      "id": "uuid",
      "content": "I need help with...",
      "author_type": "customer",
      "author_name": "John",
      "created_at": "2024-01-15T10:30:00Z",
      "is_private": false
    },
    {
      "id": "uuid",
      "content": "Happy to help! What specifically are you having trouble with?",
      "author_type": "human",
      "author_name": "Support Team",
      "created_at": "2024-01-15T10:35:00Z",
      "is_private": false
    }
  ],
  "has_more": false,
  "unread_count": 0
}
```

### GET /tickets

List tickets for a widget session.

**Query parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `widget_session_id` | string | Yes | The browser session ID |
| `status` | string | No | Filter by status: `new`, `open`, `pending`, `on_hold`, `resolved` |
| `limit` | number | No | Max tickets to return (default: 20) |
| `offset` | number | No | Pagination offset |

**Response:**

```json
{
  "count": 2,
  "results": [
    {
      "id": "uuid",
      "status": "open",
      "last_message": "Happy to help!",
      "last_message_at": "2024-01-15T10:35:00Z",
      "message_count": 2,
      "created_at": "2024-01-15T10:30:00Z",
      "unread_count": 1
    }
  ]
}
```

### POST /messages/{ticket_id}/read

Mark a ticket's messages as read by the customer.

**Request body:**

```json
{
  "widget_session_id": "uuid"
}
```

**Response:**

```json
{
  "success": true,
  "unread_count": 0
}
```

## Security

The Widget API includes several security measures:

### Origin validation

Requests are validated against the `widget_domains` setting in your project configuration. If you've configured allowed domains, requests from other origins will be rejected.

### Session-based access control

Users can only access tickets associated with their `widget_session_id`. This prevents users from viewing other people's conversations.

### Honeypot

A hidden `_hp` field is used to reject bot submissions. If this field contains any value, the request is rejected.

### Rate limiting

The API enforces rate limits to prevent abuse:
- Per-user throttling based on `widget_session_id`
- Per-team throttling for overall usage

If you hit rate limits, you'll receive a `429 Too Many Requests` response. Wait a few seconds before retrying.

## Error responses

| Status | Description |
|--------|-------------|
| `400` | Bad request - missing required fields or invalid data |
| `401` | Unauthorized - invalid or missing token |
| `403` | Forbidden - origin not allowed or session mismatch |
| `404` | Not found - ticket doesn't exist or doesn't belong to this session |
| `429` | Too many requests - rate limited |
| `500` | Server error |

## When to use the HTTP API

Use the HTTP API directly when:
- Building a mobile app (where the JS SDK isn't available)
- Integrating with a backend service
- Building a completely custom implementation

For web applications, we recommend using the [JavaScript SDK](/docs/support/javascript-api) instead, which provides:
- Automatic session management
- Built-in error handling
- Simpler method signatures
- Automatic PostHog integration
