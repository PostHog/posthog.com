---
title: Use Pomerium as a reverse proxy
sidebar: Docs
showTitle: true
---

import ProxyCallout from "../_snippets/proxy-callout.mdx"

<ProxyCallout />

This guide shows you how to use [Pomerium](https://www.pomerium.com/) as a reverse proxy for PostHog.

Pomerium is an identity-aware proxy with two deployment options:

- **Pomerium Zero:** Managed service with a web UI
- **Pomerium Core:** Self-hosted with YAML configuration

Both require creating two routes and a public access policy.

## Option 1: Pomerium Zero

For the managed service:

1. Create an "allow all" policy with **Public Access** enabled. See [Pomerium's policy docs](https://www.pomerium.com/docs/capabilities/authorization).
2. Create two routes using the values below. See [Pomerium's routing docs](https://www.pomerium.com/docs/capabilities/routing).

| Route | From | To | Path prefix |
|-------|------|-----|-------------|
| Main | `https://e.yourdomain.com` | `https://us.i.posthog.com` | N/A |
| Assets | `https://e.yourdomain.com` | `https://us-assets.i.posthog.com` | `/static` |

Replace `us` with `eu` for EU region. Apply the "allow all" policy to both routes.

## Option 2: Pomerium Core

For self-hosted Pomerium, add these routes to your `config.yaml`:

```yaml
routes:
  - from: https://e.yourdomain.com
    to: https://us.i.posthog.com
    policy:
      - allow:
          or:
            - public: true
    name: "PostHog"

  - from: https://e.yourdomain.com
    to: https://us-assets.i.posthog.com
    prefix: "/static"
    policy:
      - allow:
          or:
            - public: true
    name: "PostHog Assets"
```

Replace `e.yourdomain.com` with your subdomain. Replace `us` with `eu` for EU region.

See [Pomerium's routes documentation](https://www.pomerium.com/docs/reference/routes) for more configuration options.

## Update your PostHog SDK

Use your Pomerium domain as the API host:

```js
posthog.init('<ph_project_api_key>', {
  api_host: 'https://e.yourdomain.com',
  ui_host: 'https://us.posthog.com' // Use https://eu.posthog.com for EU region
})
```

## Troubleshooting

For common issues like region mismatches, `ui_host` configuration, and 405 errors, see [best practices and common issues](/docs/advanced/proxy#best-practices-and-common-issues).

### Authentication prompts appearing

If users are being prompted to authenticate, make sure the policy has **Public Access** enabled and is applied to both routes.

### 404 errors on static assets

Check that the assets route has the `/static` prefix configured and points to the correct assets domain.
