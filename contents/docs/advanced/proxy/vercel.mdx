---
title: Vercel reverse proxy
sidebar: Docs
showTitle: true
platformImageUrl: https://res.cloudinary.com/dmukukwp6/image/upload/vercel_logo_b6e7bcfce8.svg
---

import ProxyCallout from "../_snippets/proxy-callout.mdx"
import { Steps, Step } from 'components/Docs/Steps'

<ProxyCallout />

This guide shows you how to use [Vercel rewrites](https://vercel.com/docs/projects/project-configuration#rewrites) as a reverse proxy for PostHog.

Vercel rewrites let you proxy requests from your domain to PostHog without changing the URL in the browser. This method works for any framework deployed on Vercel.

## Using Next.js on Vercel

If you're using Next.js, you can configure rewrites in either `vercel.json` or `next.config.js`. Both work identically on Vercel.

Use this guide if you want all Vercel-specific settings in one file. Use [Next.js rewrites](/docs/advanced/proxy/nextjs) if you prefer keeping config in `next.config.js`.

Don't use both at the same time as they may conflict.

## Setup

<Steps>

<Step title="Create vercel.json">

In your project root, create a file named `vercel.json`:

```json
{
  "rewrites": [
    {
      "source": "/<ph_proxy_path>/static/:path(.*)",
      "destination": "https://us-assets.i.posthog.com/static/:path"
    },
    {
      "source": "/<ph_proxy_path>/:path(.*)",
      "destination": "https://us.i.posthog.com/:path"
    }
  ]
}
```

Replace `<ph_proxy_path>` with your chosen path. Replace `us` with `eu` for EU region.

See [Vercel's rewrites documentation](https://vercel.com/docs/projects/project-configuration#rewrites) for more details on rewrite configuration.

</Step>

<Step title="Update your PostHog SDK">

Use your proxy path as the API host:

```js
posthog.init('<ph_project_api_key>', {
  api_host: '/<ph_proxy_path>',
  ui_host: 'https://us.posthog.com' // Use https://eu.posthog.com for EU region
})
```

Replace `<ph_proxy_path>` with your chosen path.

</Step>

<Step title="Deploy to Vercel">

Deploy your changes to Vercel. The rewrites will be active once deployed.

</Step>

</Steps>

## Troubleshooting

For common issues like region mismatches, `ui_host` configuration, and 405 errors, see [best practices and common issues](/docs/advanced/proxy#best-practices-and-common-issues).

### Rewrites not working

Make sure:

1. Your `vercel.json` file is in your project root, same level as `package.json`.
2. The file is valid JSON with no syntax errors.
3. The rewrites are listed in the correct order: static assets first, then catch-all.

### 404 errors on proxy path

If you're getting 404 errors, the rewrite pattern may not be matching correctly. Use Vercel's named parameter syntax with `(:path(.*)` instead of `(.*)`:

```json
{
  "rewrites": [
    {
      "source": "/<ph_proxy_path>/static/:path(.*)",
      "destination": "https://us-assets.i.posthog.com/static/:path"
    },
    {
      "source": "/<ph_proxy_path>/:path(.*)",
      "destination": "https://us.i.posthog.com/:path"
    }
  ]
}
```

Also check:

1. Your `vercel.json` is being deployed with your project. Check the Vercel dashboard.
2. No other rewrites are conflicting. If you have a catch-all rewrite like `"source": "/(.*)"`, move it to the last position.

### Works locally but 401 errors on Vercel

If events work on localhost but return 401 errors when deployed to Vercel, this is usually a region mismatch. Double-check that your rewrite destinations match your PostHog project's region.

### Conflicts with Next.js rewrites

If you're using both `vercel.json` rewrites and Next.js `next.config.js` rewrites, choose one method and remove the other to avoid conflicts.
