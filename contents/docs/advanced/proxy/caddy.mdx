---
title: Caddy reverse proxy
sidebar: Docs
showTitle: true
showStepsToc: true
platformImageUrl: https://res.cloudinary.com/dmukukwp6/image/upload/q_auto,f_auto/caddysquare_cd0e535312.png
---

import ProxyCallout from "../_snippets/proxy-callout.mdx"
import { Steps, Step } from 'components/Docs/Steps'

<ProxyCallout />

This guide shows you how to configure [Caddy](https://caddyserver.com/) as a reverse proxy for PostHog.

Caddy automatically handles TLS certificates, making setup simple. There are three options:

1. **Basic setup:** Proxy PostHog through a dedicated subdomain like `e.yourdomain.com`
2. **Use a subpath:** Proxy PostHog through a path on an existing domain like `yourdomain.com/ph-proxy`. Useful when running other services on the same domain or for local testing.
3. **Run with Docker:** Same as Option 1, but runs Caddy in a Docker container

## Prerequisites

- [Caddy installed](https://caddyserver.com/docs/install) on your server or via Docker
- A domain with DNS records pointing to your server
- Ports 80 and 443 open and directed toward Caddy

## Option 1: Basic setup

This setup proxies all PostHog requests through your own subdomain.

<Steps>

<Step title="Create a Caddyfile">

In your working directory, create a file named `Caddyfile`:

```caddy
${YOUR_TRACKING_DOMAIN} {
  handle /static/* {
    reverse_proxy https://us-assets.i.posthog.com:443 {
      header_up Host us-assets.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }
  handle {
    reverse_proxy https://us.i.posthog.com:443 {
      header_up Host us.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }
}
```

Replace `${YOUR_TRACKING_DOMAIN}` with your subdomain, like `e.yourdomain.com`. Replace `us` with `eu` for EU region.

</Step>

<Step title="Start Caddy">

Run this command from the same directory as your `Caddyfile`:

```bash
caddy start
```

See [Caddy's quick start guide](https://caddyserver.com/docs/quick-starts/reverse-proxy) for more details.

</Step>

<Step title="Update your PostHog SDK">

Point PostHog to your tracking domain:

```js
posthog.init('<ph_project_api_key>', {
  api_host: 'https://e.yourdomain.com',
  ui_host: 'https://us.posthog.com' // Use https://eu.posthog.com for EU region
})
```

Replace `e.yourdomain.com` with your actual tracking domain.

</Step>

</Steps>

## Option 2: Use a subpath

If you're running other services on the same domain, you can proxy PostHog through a subpath like `/ph-proxy`.

<Steps>

<Step title="Create a Caddyfile with subpath routing">

```caddy
:2015 {
  handle_path /ph-proxy/static* {
    rewrite * /static/{path}
    reverse_proxy https://us-assets.i.posthog.com:443 {
      header_up Host us-assets.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }

  handle_path /ph-proxy* {
    rewrite * {path}
    reverse_proxy https://us.i.posthog.com:443 {
      header_up Host us.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }

  file_server browse
}
```

This configuration:
- Routes PostHog requests through `/ph-proxy`
- Serves local files from the same directory
- Listens on port 2015 for local testing

</Step>

<Step title="Create a test HTML file">

In the same directory, create `home.html` to test your proxy:

```html
<!DOCTYPE html>
<html>
<head>
  <title>Test PostHog Proxy</title>
</head>
<body>
  <h1>Test home page</h1>

  <script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);

    posthog.init('<ph_project_api_key>', {
      api_host: 'http://localhost:2015/ph-proxy',
      ui_host: 'https://us.posthog.com' // Use https://eu.posthog.com for EU region
    })
  </script>
</body>
</html>
```

</Step>

<Step title="Test your setup">

1. Start Caddy: `caddy start`
2. Open `http://localhost:2015/home.html` in your browser
3. Check your browser's network tab to verify requests go to `/ph-proxy`

</Step>

</Steps>

## Option 3: Run Caddy with Docker

You can also run Caddy in a Docker container if you prefer containerized deployments.

<Steps>

<Step title="Create your Caddyfile">

On your server, create a Caddyfile in `/etc/caddy`:

```caddy
${YOUR_TRACKING_DOMAIN} {
  header {
    Access-Control-Allow-Origin https://${YOUR_TRACKING_DOMAIN}
  }

  handle /static/* {
    reverse_proxy https://us-assets.i.posthog.com:443 {
      header_up Host us-assets.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }
  handle {
    reverse_proxy https://us.i.posthog.com:443 {
      header_up Host us.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }
}
```

Replace `${YOUR_TRACKING_DOMAIN}` with your domain. If you want to test from `localhost` or other domains, adjust the `Access-Control-Allow-Origin` header accordingly.

</Step>

<Step title="Start the Caddy container">

Run this command to start Caddy with Docker:

```bash
docker run -p 80:80 -p 443:443 \
  -v $PWD/Caddyfile:/etc/caddy/Caddyfile \
  -v caddy_data:/data \
  caddy
```

This mounts your Caddyfile and persists Caddy's data, including certificates, in a Docker volume.

See the [Caddy Docker documentation](https://hub.docker.com/_/caddy) for more details about persisting data in the `/data` folder.

</Step>

<Step title="Update your PostHog SDK">

Use your tracking domain as the API host:

```js
posthog.init('<ph_project_api_key>', {
  api_host: 'https://e.yourdomain.com',
  ui_host: 'https://us.posthog.com' // Use https://eu.posthog.com for EU region
})
```

</Step>

</Steps>

## Troubleshooting

### CORS errors

If you see "has been blocked by CORS" errors in your browser console, add explicit CORS headers to your Caddyfile:

```caddy
${YOUR_TRACKING_DOMAIN} {
  @options method OPTIONS
  handle @options {
    header Access-Control-Allow-Origin "https://yourdomain.com"
    header Access-Control-Allow-Methods "GET, POST, OPTIONS"
    header Access-Control-Allow-Headers "*"
    respond 204
  }

  header {
    Access-Control-Allow-Origin "https://yourdomain.com"
    Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Access-Control-Allow-Headers "*"
  }

  handle /static/* {
    reverse_proxy https://us-assets.i.posthog.com:443 {
      header_up Host us-assets.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }
  handle {
    reverse_proxy https://us.i.posthog.com:443 {
      header_up Host us.i.posthog.com
      header_down -Access-Control-Allow-Origin
    }
  }
}
```

Replace `https://yourdomain.com` with the origin of your website where PostHog is installed.