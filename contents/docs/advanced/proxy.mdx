---
title: Deploy a reverse proxy
sidebar: Docs
showTitle: true
---

import ProxyCallout from './_snippets/proxy-callout.mdx'
import ProxyPlatforms from './proxy/_snippets/proxy-platforms'
import ProxyDecisionTree from './proxy/_snippets/proxy-decision-tree'

<CalloutBox icon="IconWarning" title="Before you start" type="fyi">

If you use a self-hosted proxy, PostHog can't help troubleshoot. Use [our managed reverse proxy](/docs/advanced/proxy/managed-reverse-proxy) if you want support.

</CalloutBox>

A reverse proxy routes events from your domain to PostHog. Instead of sending events directly to PostHog's domain, you send them through your own subdomain like `e.yourdomain.com`.

Setting up a reverse proxy helps you capture more complete data about how people use your product. Ad blockers target well-known analytics domains but miss events sent through your own domain.

You can set up a reverse proxy before or after installing PostHog. If you set it up first, configure your SDK to use your proxy domain from the start. If you add it later, update your existing configuration.

## Why use a reverse proxy?

Ad blockers maintain lists of known analytics domains. When they visit `posthog.com` or similar services, they catalog tracking scripts and add them to block lists. This means a significant portion of your events never reach PostHog.

A reverse proxy bypasses this by routing events through your own domain. Ad blockers haven't visited your domain to catalog your setup, so your events go through. This typically increases event capture by 10-30% depending on your user base.

## Choose your proxy option

### Managed reverse proxy (recommended)

Point a subdomain to PostHog and we handle SSL certificates, routing, and maintenance automatically. If you run into issues, we provide support.

This option requires our [platforms add-ons](/platform-packages) and is the fastest way to get a proxy running.

<div>

<CallToAction to="/docs/advanced/proxy/managed-reverse-proxy">Set up managed reverse proxy</CallToAction>

</div>

### Deploy your own proxy

If you need full control or have existing infrastructure you want to use, you can deploy your own reverse proxy. If you use a self-hosted proxy, PostHog can't help troubleshoot configuration issues.

Choose your platform and follow the setup guide:

<ProxyPlatforms />

### Need help choosing?

<ProxyDecisionTree />

## Configuration overview

After your proxy is running, you'll need to configure a few things. Each setup guide covers these steps in detail, but here's what to expect:

1. **Choose your subdomain carefully**. Ad blockers look for obvious terms. Avoid words like `posthog`, `analytics`, `tracking`, or `telemetry` in your subdomain or paths. Use something neutral like `e.yourdomain.com` or `ph.yourdomain.com`.
2. **Update your PostHog SDK configuration**. Point your SDK to your proxy domain instead of PostHog's domain. Always set both `api_host` (your proxy) and `ui_host` (PostHog's actual domain) so features like the toolbar work correctly:

  ```js
  posthog.init('<ph_project_api_key>', {
    api_host: 'https://e.yourdomain.com',
    ui_host: 'https://us.posthog.com' // or https://eu.posthog.com
  })
  ```

3. **Verify events are flowing**. Open your browser's network tab, trigger an event, and confirm requests to your proxy return `200 OK`. Then check your PostHog dashboard to verify events appear.

## Technical requirements

Your reverse proxy must route two types of requests to PostHog. Static assets go to one domain, and API requests go to another.

Here's the routing structure you need:

```yaml
- route: e.yourdomain.com/static/*
  reverse_proxy: https://us-assets.i.posthog.com/static/* # or https://eu-assets.i.posthog.com/static/*
  host_header: us-assets.i.posthog.com # or eu-assets.i.posthog.com

- route: e.yourdomain.com/*
  reverse_proxy: https://us.i.posthog.com/* # or https://eu.i.posthog.com/*
  host_header: us.i.posthog.com # or us.i.posthog.com
```

The `host_header` tells PostHog which domain the request is for. Without it, PostHog won't know how to route your request and you'll get 401 errors.

### Size limits

PostHog events can be up to 1MB per message and session recordings up to 64MB per message. Make sure your proxy doesn't set lower limits, or large recordings will fail silently.

### Using a different tool?

If you're using a proxy tool we haven't documented, follow the routing structure above. The key requirements are:

- Route `/static/*` to `us-assets.i.posthog.com` or `eu-assets.i.posthog.com`
- Route everything else to `us.i.posthog.com` or `eu.i.posthog.com`
- Set the `Host` header to match the PostHog domain
- Don't modify request bodies or headers, except `Host`
- Support both `GET` and `POST` requests

## Best practices

### Always set ui_host

When using a reverse proxy, you must set `ui_host` to PostHog's actual domain. This ensures the toolbar, recordings player, and other features link correctly:

```js
posthog.init('<ph_project_api_key>', {
  api_host: 'https://e.yourdomain.com',
  ui_host: 'https://us.posthog.com' // or https://eu.posthog.com
})
```

Without `ui_host`, features will try to link to your proxy domain instead of PostHog, breaking navigation.

### Match your PostHog region

Your proxy must point to the same region as your PostHog project:

- **US region:** `us.i.posthog.com` and `us-assets.i.posthog.com`
- **EU region:** `eu.i.posthog.com` and `eu-assets.i.posthog.com`

Mismatched regions cause `401` or `no_api_key` errors. Check your project URL in the [PostHog app](https://app.posthog.com) to confirm your region.

### Avoid obvious tracking terms everywhere

Ad blockers scan more than just your subdomain. They also check request paths. Don't use paths like:

- `/analytics/*`
- `/tracking/*`
- `/telemetry/*`
- `/posthog/*`

Use neutral paths like `/e` or `/ph` instead.

## Troubleshooting

Having issues? See [Troubleshooting reverse proxies](/docs/advanced/proxy/troubleshooting) for help with common errors like 401s, 405s, and events not appearing.

## FAQ

### Why doesn't PostHog use its own proxy?

We do use our own infrastructure. But ad blockers specifically target well-known analytics domains. When they visit `posthog.com`, they catalog our tracking scripts and add them to block lists.

Your proxy works because ad blockers haven't visited your domain to catalog your setup. They don't know what to block.

### Does PostHog provide static IP addresses?

No. Our domains use AWS infrastructure with load balancing, which rotates IPs for performance and reliability.

If your firewall requires IP allowlisting, you have two options:

**Option 1: Use domain-based filtering**

Allow outbound HTTPS traffic on port 443 to `*.posthog.com`, or allow specific domains: `us.i.posthog.com` and `us-assets.i.posthog.com`. Replace `us` with `eu` for EU region.

**Option 2: Deploy a reverse proxy with a static IP**

This is the recommended approach for enterprise environments with strict firewall policies.

1. Deploy a [reverse proxy](#choose-your-proxy-option) in your infrastructure
2. Assign your proxy a static IP address
3. Allowlist only your proxy's IP in your firewall

This gives you full control over network routing without depending on PostHog's infrastructure.
