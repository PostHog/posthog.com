---
title: Android
sidebarTitle: Android
sidebar: Docs
showTitle: true
github: 'https://github.com/PostHog/posthog-android'
icon: >-
  https://res.cloudinary.com/dmukukwp6/image/upload/posthog.com/contents/images/docs/integrate/android.svg
features:
  eventCapture: true
  userIdentification: true
  autoCapture: false
  sessionRecording: true
  featureFlags: true
  groupAnalytics: true
  surveys: false
  llmObservability: false
  errorTracking: false
---

It uses an internal queue to make calls fast and non-blocking. It also batches requests and flushes asynchronously, making it perfect to use in any part of your mobile app.

import AndroidInstall from '../../integrate/_snippets/install-android.mdx'
import AndroidSendEvents from '../../integrate/send-events/_snippets/send-events-android.mdx'
import AndroidIdentify from './\_snippets/identify.mdx'

## Installation

<AndroidInstall />

## Capturing events

<AndroidSendEvents />

## Identifying users

> We highly recommend reading our section on [Identifying users](/docs/integrate/identifying-users) to better understand how to correctly use this method.

<AndroidIdentify />

## Get the current user's distinct ID

You may find it helpful to get the current user's distinct ID. For example, to check whether you've already called `identify` for a user or not.

To do this, call `distinctId()`. This returns either the ID automatically generated by PostHog or the ID that has been passed by a call to `identify()`.

## Alias

Sometimes, you want to assign multiple distinct IDs to a single user. This is helpful when your primary distinct ID is inaccessible. For example, if a distinct ID used on the frontend is not available in your backend.

In this case, you can use `alias` to assign another distinct ID to the same user.

```kotlin
/**
 * Create an alias for the current user.
 */
PostHog.alias("distinct_id")
```

We strongly recommend reading our docs on [alias](/docs/data/identify#alias-assigning-multiple-distinct-ids-to-the-same-user) to best understand how to correctly use this method.

## Anonymous and identified events

import IdentifiedVsAnonymousIntro from '../../product-analytics/_snippets/identified-vs-anonymous-intro.mdx'

<IdentifiedVsAnonymousIntro />

### How to capture anonymous events

import HowToCaptureAnonymousEventsAndroid from '../../product-analytics/_snippets/how-to-capture-anonymous-events-android.mdx'

<HowToCaptureAnonymousEventsAndroid />

### How to capture identified events

import HowToCaptureIdentifiedEvents from '../../product-analytics/_snippets/how-to-capture-identified-events-android.mdx'

<HowToCaptureIdentifiedEvents />


## Setting person properties

To set [properties](/docs/data/user-properties) on your users via an event, you can leverage the event properties `userProperties` and `userPropertiesSetOnce`.

When capturing an event, you can pass a property called `userProperties` as an event property, and specify its value to be an object with properties to be set on the user that will be associated with the user who triggered the event.

```kotlin
import com.posthog.PostHog

PostHog.capture(
    event = "button_b_clicked",
    properties = mapOf("color" to "blue"),
    userProperties = mapOf(
        "string" to "value1",
        "integer" to 2
    )
)
```

`userPropertiesSetOnce` works just like `userProperties`, except that it will **only set the property if the user doesn't already have that property set**.

```kotlin
import com.posthog.PostHog

PostHog.capture(
    event = "button_b_clicked",
    properties = mapOf("color" to "blue"),
    userPropertiesSetOnce = mapOf(
        "string" to "value1",
        "integer" to 2
    )
)
```

## Super Properties

Super Properties are properties associated with events that are set once and then sent with every `capture` call, be it a `$screen`, or anything else.

They are set using `PostHog.register`, which takes a key and value, and they persist across sessions.

For example, take a look at the following call:

```kotlin
import com.posthog.PostHog

PostHog.register("team_id", 22)
```

The call above ensures that every event sent by the user will include `"team_id": 22`. This way, if you filtered events by property using `team_id = 22`, it would display all events captured on that user after the `PostHog.register` call, since they all include the specified Super Property.

However, please note that this does not store properties against the User, only against their events. To store properties against the User object, you should use `PostHog.identify`. More information on this can be found on the [Sending User Information section](#sending-user-information).

### Removing stored Super Properties

Super Properties are persisted across sessions so you have to explicitly remove them if they are no longer relevant. In order to stop sending a Super Property with events, you can use `PostHog.unregister`, like so:

```kotlin
import com.posthog.PostHog

PostHog.unregister("team_id")
```

This will remove the Super Property and subsequent events will not include it.

If you are doing this as part of a user logging out you can instead simply use `PostHog.reset` which takes care of clearing all stored Super Properties and more.

## Opt out of data capture

You can completely opt-out users from data capture. To do this, there are two options:

1. Opt users out by default by setting `optOut` to `true` in your PostHog config:

```kotlin
val config = PostHogAndroidConfig(
    apiKey = <ph_project_api_key>,
    host = <ph_client_api_host> 
)
config.optOut = true
PostHogAndroid.setup(this, config)
```

2. Opt users out on a per-person basis by calling `optOut()`:

```kotlin
PostHog.optOut()
```

Similarly, you can opt users in:

```kotlin
PostHog.optIn()
```

To check if a user is opted out:

```kotlin
PostHog.isOptOut()
```

## Flush

You can set the number of events in the configuration that should queue before flushing.
Setting this to `1` will send events immediately and will use more battery. The default value for this is `20`.

You can also configure the flush interval. By default we flush all events after `30` seconds,
no matter how many events have been gathered.

```kotlin
import com.posthog.android.PostHogAndroidConfig

val config = PostHogAndroidConfig(apiKey = POSTHOG_API_KEY, host = POSTHOG_HOST).apply { 
    flushAt = 20
    flushIntervalSeconds = 30
}
```

You can also manually flush the queue:

```kotlin
import com.posthog.PostHog

PostHog.flush() 
```

## Reset after logout

To reset the user's ID and anonymous ID, call `reset`. Usually you would do this right after the user logs out.

```kotlin
import com.posthog.PostHog

PostHog.reset()
```

## Feature Flags

import FeatureFlagsLibsIntro from "../_snippets/feature-flags-libs-intro.mdx"

<FeatureFlagsLibsIntro />

import AndroidFeatureFlagsCode from '../../integrate/feature-flags-code/_snippets/feature-flags-code-android.mdx'

<AndroidFeatureFlagsCode />

## Experiments (A/B tests)

Since [experiments](/docs/experiments/manual) use feature flags, the code for running an experiment is very similar to the feature flags code:

```kotlin
import com.posthog.PostHog

if (PostHog.getFeatureFlag("experiment-feature-flag-key") == "variant-name") {
    // do something
}
```

It's also possible to [run experiments without using feature flags](/docs/experiments/running-experiments-without-feature-flags).

## Group analytics

Group analytics allows you to associate the events for that person's session with a group (e.g. teams, organizations, etc.). Read the [Group Analytics](/docs/user-guides/group-analytics) guide for more information.

> **Note: ** This is a paid feature and is not available on the open-source or free cloud plan. Learn more [here](/pricing).

-   Associate the events for this session with a group

```kotlin
import com.posthog.PostHog

// organization is the group type, company_id_in_your_db is the group ID
PostHog.group(
    type = "company", 
    key = "company_id_in_your_db"
)
```

-   Associate the events for this session with a group AND update the properties of that group

```kotlin
import com.posthog.PostHog

PostHog.group(
    type = "company", 
    key = "company_id_in_your_db",
    groupProperties = mapOf("name" to "Awesome Inc.")
)
```

The `name` is a special property which is used in the PostHog UI for the name of the group. If you don't specify a `name` property, the group ID will be used instead.

## Session replay

To set up [session replay](/docs/session-replay/mobile) in your project, all you need to do is install the Android SDK, enable "Record user sessions" in [your project settings](https://us.posthog.com/settings/project-replay) and enable the `sessionReplay` option.

## All configuration options

When creating the PostHog client, there are many options you can set:

```kotlin
val config = PostHogAndroidConfig(apiKey = POSTHOG_API_KEY, host = POSTHOG_HOST).apply {
    // Capture certain application events automatically. (on/true by default)
    captureApplicationLifecycleEvents = true

    // Capture screen views automatically. (on/true by default)
    captureScreenViews = true // (on/true by default)

    // Capture deep links as part of the screen call. (on/true by default)
    captureDeepLinks = true

    // Maximum number of events to keep in queue before flushing (20 by default)
    flushAt = 20

    // Number of maximum events in memory and disk, when the maximum is exceed, the oldest event is deleted and the new one takes place. (1000 by default)
    maxQueueSize = 1000

    // Number of maximum events in a batch call. (50 by default)
    maxBatchSize = 50

    // Maximum delay before flushing the queue (30 seconds)
    flushIntervalSeconds = 30

    // Logs the SDK messages into Logcat. (off/false by default)
    debug = false

    // Prevents capturing any data if enabled. (off/false by default)
    optOut = false

    // Send a '$feature_flag_called' event when a feature flag is used automatically. (on/true by default)
    sendFeatureFlagEvent = true

    // Preload feature flags automatically. (on/true by default)
    preloadFeatureFlags = true

    // Callback that is called when feature flags are loaded (not set by default)
    onFeatureFlags = { ... }

    // Callback that allows to sanitize the event properties (not set by default)
    propertiesSanitizer = { properties -> ... }

    // Hook for encrypt and decrypt events
    // Devices are sandbox already
    // Defaults to no encryption
    encryption = object : PostHogEncryption { ... }

    // Hook that allows for modification of the default mechanism for
    // generating anonymous id (which as of now is just random UUID v7)
    getAnonymousId = { ... }

    // Determines the behavior for processing user profiles.
    // Defaults to PersonProfiles.IDENTIFIED_ONLY
    personProfiles = PersonProfiles.IDENTIFIED_ONLY

    // Enable Recording of Session Replay. (off/false by default)
    sessionReplay = false

    // Session Replay configuration
    sessionReplayConfig = PostHogSessionReplayConfig(...)
}
```
