---
title: Hono
icon: >-
  https://res.cloudinary.com/dmukukwp6/image/upload/hono_9d80c0611c.svg
---
import { CalloutBox } from 'components/Docs/CalloutBox'

PostHog makes it easy to get data about usage of your [Hono](https://hono.dev/) app. 
Integrating PostHog into your app enables analytics about user behavior, custom events 
capture, session replays, feature flags, and more.

## Installation
Start by installing the `posthog-node` package using your package manager.
```sh
npm install --save posthog-node
```

Then, create a [middleware](https://hono.dev/docs/guides/middleware) to capture events for your routes.

```js file="middleware.js"
const posthogServerMiddleware = createMiddleware(async (c, next) => {
    const { POSTHOG_HOST, POSTHOG_PUBLIC_KEY } = env<{ POSTHOG_HOST, POSTHOG_PUBLIC_KEY }>(c)
    const posthog = new PostHog(POSTHOG_PUBLIC_KEY, { host: POSTHOG_HOST })

    posthog.capture({
        distinctId: 'distinct_id_of_user', // Their user id or email
        event: 'user_did_something',
    })
    await posthog.shutdown() // TIP: On program exit, call shutdown to stop pending pollers and flush any remaining events
    await next()
})
```

<CalloutBox icon="IconInfo" title="Shutdown">

Make sure to always call `posthog.shutdown()` after capturing events from the server-side. 
PostHog queues events into larger batches, and this call forces all batched events to be flushed immediately.

</CalloutBox>

Next, apply this middleware to your app. This middleware will be called on every request handled by Hono,
denoted by the wildcard `*`.

```ts file=index.ts
// use the middleware on all (*) routes.
app.use('*', posthogServerMiddleware)
```

In your routes, you can pass information to be captured by your middleware using [context `set()` and `get()` pair](https://hono.dev/docs/api/context#set-get)

## Error tracking
Hono uses [`app.onError`](https://hono.dev/docs/api/exception#handling-httpexception) for root-level
error handling. You can take advantage of this for [Error tracking](/docs/error-tracking).

```ts file=index.ts
app.onError((err, c) => {
  const { POSTHOG_HOST, POSTHOG_PUBLIC_KEY } = env<{ POSTHOG_HOST: string, POSTHOG_PUBLIC_KEY: string }>(c)
  const posthog = new PostHog(POSTHOG_PUBLIC_KEY, { host: POSTHOG_HOST })
  
  posthog.captureException(new Error(err.message, { cause: err }), 'user_distinct_id_with_err_rethrow', {
    path: c.req.path,
    method: c.req.method,
    url: c.req.url,
    headers: c.req.header(),
    // ... other properties
  })
  posthog.shutdown() // TIP: On program exit, call shutdown to stop pending pollers and flush any remaining events
  // other error handling logic
  return c.text('Internal Server Error', 500)
})
```

## Simple SSR
Hono supports JSX out of the box. If you're using Hono SSR without a framework, you can include a
[JavaScript snippet](/docs/libraries/js#option-1-add-the-javascript-snippet-to-your-html-span-classbg-gray-accent-light-darkbg-gray-accent-dark-text-gray-font-semibold-align-middle-text-sm-p-1-roundedrecommendedspan) 
directly in your HTML layout template.

```tsx 
const Layout = (props: SiteData) => html`
<html>
<head>
  <meta charset="UTF-8">
  <title>Hello Hono!</title>
  <head prefix="og: http://ogp.me/ns#">
  <script>
      !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
      posthog.init('<ph_project_api_key>', {api_host: '<ph_client_api_host>'})
  </script>

</head>
<body>
  ${props.children}
</body>
</html>
`

app.get('/tsx', (c) => {
  return c.html(<Layout>
    <div>Welcome to my app</div>
  </Layout>)
})
```

## SSR with a framework
If you're using Hono along side a framework, you can follow [guides for each framework](/docs/frameworks) separately.

## Next steps

For any technical questions for how to integrate specific PostHog features into Hono, have a look at our [Node](/docs/libraries/node) SDK docs
for concepts such as:
- [Capture custom events, identify users, and more.](/docs/libraries/node#capturing-events)
- [Feature flags including variants and payloads.](/docs/libraries/node#feature-flags)