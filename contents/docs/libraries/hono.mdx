---
title: Hono
icon: >-
  https://res.cloudinary.com/dmukukwp6/image/upload/hono_9d80c0611c.svg
---
import { CalloutBox } from 'components/Docs/CalloutBox'

PostHog makes it easy to get data about usage of your [Hono](https://hono.dev/) app. 
Integrating PostHog into your app enables analytics about user behavior, custom events 
capture, session replays, feature flags, and more.

## Installation
Start by installing the `posthog-node` package using your package manager.
```sh
npm install --save posthog-node
```

Then, create a [middleware](https://hono.dev/docs/guides/middleware) to capture events for your routes.

```js file="middleware.js"
const posthogServerMiddleware = createMiddleware(async (c, next) => {
    const { POSTHOG_HOST, POSTHOG_PUBLIC_KEY } = env<{ POSTHOG_HOST, POSTHOG_PUBLIC_KEY }>(c)
    const posthog = new PostHog(POSTHOG_PUBLIC_KEY, { host: POSTHOG_HOST })

    posthog.capture({
        distinctId: 'distinct_id_of_user', // Their user id or email
        event: 'user_did_something',
    })
    await posthog.shutdown() // TIP: On program exit, call shutdown to stop pending pollers and flush any remaining events
    await next()
})
```

<CalloutBox icon="IconInfo" title="Shutdown">

Make sure to always call `posthog.shutdown()` after capturing events from the server-side. 
PostHog queues events into larger batches, and this call forces all batched events to be flushed immediately.

</CalloutBox>

Next, apply this middleware to your app. This middleware will be called on every request handled by Hono,
denoted by the wildcard `*`.

```ts file=index.ts
// use the middleware on all (*) routes.
app.use('*', posthogServerMiddleware)
```

In your routes, you can pass information to be captured by your middleware using [context `set()` and `get()` pair](https://hono.dev/docs/api/context#set-get)

## Error tracking
Hono uses [`app.onError`](https://hono.dev/docs/api/exception#handling-httpexception) for root-level
error handling. You can take advantage of this for [Error tracking](/docs/error-tracking).

```ts file=index.ts
app.onError((err, c) => {
  const { POSTHOG_HOST, POSTHOG_PUBLIC_KEY } = env<{ POSTHOG_HOST: string, POSTHOG_PUBLIC_KEY: string }>(c)
  const posthog = new PostHog(POSTHOG_PUBLIC_KEY, { host: POSTHOG_HOST })
  
  posthog.captureException(new Error(err.message, { cause: err }), 'user_distinct_id_with_err_rethrow', {
    path: c.req.path,
    method: c.req.method,
    url: c.req.url,
    headers: c.req.header(),
    // ... other properties
  })
  posthog.shutdown() // TIP: On program exit, call shutdown to stop pending pollers and flush any remaining events
  // other error handling logic
  return c.text('Internal Server Error', 500)
})
```

## Next steps

For any technical questions for how to integrate specific PostHog features into Hono, have a look at our [Node](/docs/libraries/node) SDK docs
for concepts such as:
- [Capture custom events, identify users, and more.](/docs/libraries/node#capturing-events)
- [Feature flags including variants and payloads.](/docs/libraries/node#feature-flags)