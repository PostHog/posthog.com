import InstallWebPackageManagers from "./install-web-package-managers.mdx"
import Tab from "components/Tab"

Install `posthog-js` using your package manager:

<InstallWebPackageManagers />

### Initialize the PostHog client

Generate environment files for your project with `ng g environments`. Configure the following environment variables:

- `posthogKey`: Your project API key from your [project settings](https://app.posthog.com/settings/project#variables).
- `posthogHost`: Your project's client API host. Usually `https://us.i.posthog.com` for US-based projects and `https://eu.i.posthog.com` for EU-based projects.

<Tab.Group tabs={['Angular v17+', 'Angular v16 and below']}>
<Tab.List>
  <Tab>Angular v17+</Tab>
  <Tab>Angular v16 and below</Tab>
</Tab.List>
<Tab.Panels>
  <Tab.Panel>

  For Angular v17 and above, you can set up PostHog as a singleton service. To do this, start by creating and injecting a `PosthogService` instance.

  Create a service by running `ng g service services/posthog`. The service should look like this:

  ```ts file=posthog.service.ts
  // src/app/services/posthog.service.ts
  import { DestroyRef, Injectable, NgZone } from "@angular/core";
  import posthog from "posthog-js";
  import { environment } from "../../environments/environment";
  import { Router } from "@angular/router";

  @Injectable({ providedIn: "root" })
  export class PosthogService {
    constructor(
      private ngZone: NgZone,
      private router: Router,
      private destroyRef: DestroyRef,
    ) {
      this.initPostHog();
    }
    private initPostHog() {
      this.ngZone.runOutsideAngular(() => {
        posthog.init(environment.posthogKey, {
          api_host: environment.posthogHost,
          defaults: '<ph_posthog_js_defaults>',
          debug: false,
          cross_subdomain_cookie: true,
        });
      });
    }
  }
  ```

  The service is initialized [outside of the Angular zone](https://angular.dev/api/core/NgZone#runOutsideAngular) to reduce change detection cycles. This is important to avoid performance issues with session recording.

  Then, inject the service in your app's root component `app.component.ts`. This will make sure PostHog is initialized before any other component is rendered.

  ```ts file=app.component.ts
  // src/app/app.component.ts
  import { Component } from "@angular/core";
  import { RouterOutlet } from "@angular/router";
  import { PosthogService } from "./services/posthog.service";

  @Component({
    selector: "app-root",
    styleUrls: ["./app.component.scss"],
    template: `
      <router-outlet />`,
    imports: [RouterOutlet],
  })
  export class AppComponent {
    title = "angular-app";

    constructor(posthogService: PosthogService) {}
  }
  ```

  </Tab.Panel>
  <Tab.Panel>

  In your `src/main.ts`, initialize PostHog using your project API key and instance address. You can find both in your [project settings](https://us.posthog.com/project/settings).  

  ```ts file=main.ts
  // src/main.ts
  import { bootstrapApplication } from '@angular/platform-browser';
  import { appConfig } from './app/app.config';
  import { AppComponent } from './app/app.component';
  import { environment } from "./environments/environment"; // +
  import posthog from 'posthog-js' // +

  posthog.init(environment.posthogKey, { // +
    api_host: environment.posthogHost, // +
    defaults: '<ph_posthog_js_defaults>' // +
  }) // +

  bootstrapApplication(AppComponent, appConfig)
    .catch((err) => console.error(err));
  ```  

  </Tab.Panel>
</Tab.Panels>
</Tab.Group>
