There are 3 steps to implement feature flags using the PostHog API:

### Step 1: Evaluate the feature flag value using `decide`

`decide` is the endpoint used to determine if a given flag is enabled for a certain user or not.

#### Request

<MultiLanguage>

```shell
curl -v -L --header "Content-Type: application/json" -d '  {
    "api_key": "<ph_project_api_key>",
    "distinct_id": "distinct_id_of_your_user",
    "groups" : {
        "group_type": "group_id"
    }
}' "<ph_client_api_host>/decide?v=3"
```

```python
import requests
import json

url = "<ph_client_api_host>/decide?v=3"
headers = {
    "Content-Type": "application/json"
}
payload = {
    "api_key": "<ph_project_api_key>",
    "distinct_id": "user distinct id",
    "groups": {
        "group_type": "group_id"
    }
}
response = requests.post(url, headers=headers, data=json.dumps(payload))
print(response.json())
```

```node
import fetch from "node-fetch";

async function sendDecideRequest() {
    const url = "<ph_client_api_host>/decide?v=3";
    const headers = {
        "Content-Type": "application/json",
    };
    const payload = {
        api_key: "<ph_project_api_key>",
        distinct_id: "user distinct id",
        groups: {
            group_type: "group_id",
        },
    };

    const response = await fetch(url, {
        method: "POST",
        headers: headers,
        body: JSON.stringify(payload),
    });
    const data = await response.json();
    console.log(data);
}

sendDecideRequest();
```

</MultiLanguage>

> **Note:** The `groups` key is only required for group-based feature flags. If you use it, replace `group_type` and `group_id` with the values for your group such as `company: "Twitter"`.

#### Response

When called, `decide` returns the flag values and payloads, along with more information.

```json
{
  "config": {
    "enable_collect_everything": true
  },
  "toolbarParams": {},
  "errorsWhileComputingFlags": false,
  "isAuthenticated": false,
  "supportedCompression": [
    "gzip",
    "lz64"
  ],
  "featureFlags": {
    "my-awesome-flag": true,
    "my-awesome-flag-2": true,
    "my-multivariate-flag": "some-string-value",
    "flag-thats-not-on": false,
  },
  "featureFlagPayloads": {
    "my-awesome-flag": "example-payload-string",
    "my-awesome-flag-2": "{\"color\": \"blue\", \"animal\": \"hedgehog\"}"
  }
}
```

> **Note:** `errorsWhileComputingFlags` will return `true` if we didn't manage to compute some flags (for example, if there's an [ongoing incident involving flag evaluation](https://status.posthog.com/)). 
> 
> This enables partial updates to currently active flags in your clients.

import IncludePropertyInEvents from "./include-feature-flag-property-in-backend-events.mdx" 

<IncludePropertyInEvents />

To do this, include the `$feature/feature_flag_name` property in your event:

<MultiLanguage>

```shell
curl -v -L --header "Content-Type: application/json" -d '  {
    "api_key": "<ph_project_api_key>",
    "event": "your_event_name",
    "distinct_id": "distinct_id_of_your_user",
    "properties": {
      "$feature/feature-flag-key": "variant-key" # Replace feature-flag-key with your flag key. Replace 'variant-key' with the key of your variant
    }
}' <ph_client_api_host>/capture/ 
```

```python
import requests
import json

url = "<ph_client_api_host>/capture/"
headers = {
    "Content-Type": "application/json"
}
payload = {
    "api_key": "<ph_project_api_key>", 
    "event": "your_event_name",
    "distinct_id": "distinct_id_of_your_user,
    "properties": {
      "$feature/feature-flag-key": "variant-key" # Replace feature-flag-key with your flag key. Replace 'variant-key' with the key of your variant
    }
}
response = requests.post(url, headers=headers, data=json.dumps(payload))
print(response)
```

</MultiLanguage>

### Step 3: Send a `$feature_flag_called` event

To track usage of your feature flag and view related analytics in PostHog, submit the `$feature_flag_called` event whenever you check a feature flag value in your code.

You need to include two properties with this event:

1. `$feature_flag_response`: This is the name of the variant the user has been assigned to e.g., "control" or "test"
2. `$feature_flag`: This is the key of the feature flag in your experiment.

<MultiLanguage>

```shell
curl -v -L --header "Content-Type: application/json" -d '  {
    "api_key": "<ph_project_api_key>",
    "event": "$feature_flag_called",
    "distinct_id": "distinct_id_of_your_user",
    "properties": {
      "$feature_flag": "feature-flag-key",
      "$feature_flag_response": "variant-name"
    }
}' <ph_client_api_host>/capture/ 
```

```python
import requests
import json

url = "<ph_client_api_host>/capture/"
headers = {
    "Content-Type": "application/json"
}
payload = {
    "api_key": "<ph_project_api_key>", 
    "event": "feature_flag_called",
    "distinct_id": "distinct_id_of_your_user,
    "properties": {
      "$feature_flag": "feature-flag-key",
      "$feature_flag_response": "variant-name"
    }
}
response = requests.post(url, headers=headers, data=json.dumps(payload))
print(response)
```

</MultiLanguage>

import APIOverrideServerProperties from './override-server-properties/api.mdx'

<APIOverrideServerProperties />