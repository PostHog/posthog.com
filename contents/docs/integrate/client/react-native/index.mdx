---
title: React Native library
layout: library
sidebarTitle: React Native
sidebar: Docs
showTitle: true
github: https://github.com/PostHog/posthog-react-native
features:
    eventCapture: true
    userIdentification: true
    autoCapture: true
    sessionRecording: false
    featureFlags: true
    groupAnalytics: true
---

Purely built for React Native, this library allows you to integrate PostHog with your React Native project. For React Native projects built with Expo, there are no mobile native dependencies outside of supported Expo packages.


## Installation

In your React Native or Expo project add the `@posthog/react-native` package to your project as well as the required peer dependencies.

```bash
# React Native
yarn add @posthog/react-native expo-file-system expo-application expo-device
# (Optional) Install extra libraries for more enriched events
yarn add install expo-localization expo-network

# Expo
expo install @posthog/react-native expo-file-system expo-application expo-device
# (Optional) Install extra libraries for more enriched events
expo install expo-localization expo-network
```

## Configuration

The recommended flow for sertting up PostHog React Native is to use the `PostHogProvider` which utilises the Context API to pass posthog around as well as enabling autocapture and ensuring that the queue is flushed at the right time:

```jsx
// App.(js|ts)
import PostHog, { usePostHog } from 'posthog-react-native'
...

export function MyApp() {
    return (
        <PostHogProvider apiKey="<ph_project_api_key>" options={{
            // PostHog API host (https://app.posthog.com by default)
            host: '<ph_instance_address>',
        }}>
            <MyComponent />
        </PostHogProvider>
    )
}

// The rest of this documentation assumes you are using the `PostHogProvider` 
// and as such can utilise the `usePostHog` hook as follows:

const MyComponent = () => {
    const posthog = usePostHog()

    useEffect(() => {
        posthog.capture("MyComponent loaded", { foo: "bar" })
    }, [])
}
```

Alternatively you can simply create a global instance of PostHog with your API Key and any options. This allows you to use PostHog outside of the `PostHogProvider` but limits the functionality of PostHog (such as autocapture).

```js
// posthog.js
import PostHog from 'posthog-react-native'

export const posthog = new PostHog("<ph_project_api_key>", {
    // PostHog API host (https://app.posthog.com by default)
    host: '<ph_instance_address>',
})


// app.js
import posthog from './posthog'

posthog.identify("example@posthog.com")

// You can even use this instance with the PostHogProvider
export function MyApp() {
    return (
        <PostHogProvider client={posthog}>
            {/* Your app code */}
        </PostHogProvider>
    )
}
```
## Usage

### Autocapture

Autocapture tracks these events:

* **Application Opened** - once when the App is opened from a closed state
* **Application Became Active** - when the App comes to the foreground (e.g. from the app switcher)
* **Application Backgrounded** - when the App is sent to the background by the user
* **Keyboard Shown** - when the keyboard appears for user input
* **Keyboard Hidden** - when the keyboard is dismissed from user input
* **$screen** - when the user navigates (if using @react-navigation/native)
* **$autocapture** - touch events when the user interacts with the screen

With Autocapture, all touch events for children of `PosthogProvider` will be tracked, capturing a snapshot of the view heirachy at that point. This allows you to create Insights in PostHog without having to add many custom events.

PostHog will try to generate a sensible name for the touched element based on the React component `displayName` or `name` but you can force this to something reliable (and also clearly marked for posthog tracking) using the `ph-label` prop.

```jsx
<View ph-label="my-special-label"></View>
```

If there are elements you don't want to be captured, you can add the `ph-no-capture` property like so. If this property is found anywhere in the view heirachy, the entire touch event is ignored.

```jsx
<View ph-no-capture>Sensitive view here</View>
```

Basic usage:
```jsx
// App.(js|ts)
import PostHog from 'posthog-react-native'
import {NavigationContainer} from '@react-navigation/native';

export function App() {
    return (
        <NavigationContainer>
            <PostHogProvider apiKey="<ph_project_api_key>" autocapture>
                {/* Rest of app */}
            </PostHogProvider>
        </NavigationContainer>
    )
}
```

You can tweak how autocapture works by passing custom options.

```jsx
<PostHogProvider apiKey="<ph_project_api_key>" autocapture={{
    captureTouches: true, // If you don't want to capture touch events set this to false
    ignoreLabels: [], // Any labels here will be ignored from the stack in touch events
    customLabelProp: "ph-label",
    noCaptureProp: "ph-no-capture",

    navigation: {
        // By default only the Screen name is tracked but it is possible to track the 
        // params or modify the name by intercepting theautocapture like so
        routeToName: (name, params) => {
            if (params.id) return `${name}/${params.id}`
            return name
        },
        routeToParams: (name, params) => {
            if (name === "SensitiveScreen) return undefined
            return params
        },
    }
}}>
    ...
</PostHogProvider>
```

### Identify

> We highly recommend reading our section on [Identifying users](/docs/integrate/identifying-users) to better understand how to correctly use this method.

When you start tracking events with PostHog, each user gets an anonymous ID that is used to identify them in the system.
In order to link this anonymous user with someone from your database, use the `identify` call. 

Identify lets you add metadata on your users so you can more easily identify who they are in PostHog, and even do things 
like segment users by these properties.

An identify call requires:

* `distinctId` which uniquely identifies your user in your database
* `userProperties` with a dictionary with key: value pairs

```javascript
posthog.identify('distinctID', {
    email: 'user@posthog.com',
    name: 'My Name'
})
```

The most obvious place to make this call is whenever a user signs up, or when they update their information.

When you call `identify`, all previously tracked anonymous events will be linked to the user.

### Capture

Capture allows you to capture anything a user does within your system, which you can later use in PostHog to find 
patterns in usage, work out which features to improve or where people are giving up.

A `capture` call requires:

* `event` to specify the event name
  * We recommend naming events with "[noun] [verb]", such as `movie played` or `movie updated`, in order to easily identify what your events mean later on (we know this from experience).

Optionally you can submit:

* `properties`, which is an object with any information you'd like to add

For example:

```javascript
posthog.capture('Button B Clicked', {
    color: "blue",
    icon: "new2-final"
})
```

#### Setting user properties via an event

When capturing an event, you can pass a property called `$set` as an event property, and specify its value to be an object with properties to be set on the user that will be associated with the user who triggered the event.

##### $set

**Example**

```js
posthog.capture('some event', { $set: { userProperty: 'value' } })
```

**Usage**

When capturing an event, you can pass a property called `$set` as an event property, and specify its value to be an object with properties to be set on the user that will be associated with the user who triggered the event.

##### $set_once

**Example**

```js
posthog.capture('some event', { $set_once: { userProperty: 'value' } })
```

**Usage**

`$set_once` works just like `$set`, except that it will **only set the property if the user doesn't already have that property set**.

### Flush

You can set the number of events in the configuration that should queue before flushing.
Setting this to `1` will send events immediately and will use more battery. This is set to `20` by default.

You can also configure the flush interval. By default we flush all events after `30` seconds,
no matter how many events have gathered.

You can also manually flush the queue, like so:

```javascript
posthog.flush()
// or using async/await
await posthig.flushAsync()
```

### Reset

To reset the user's ID and anonymous ID, call `reset`. Usually you would do this right after the user logs out.

```javascript
posthog.reset()
```

### Opt in/out

By default, PostHog has tracking enabled unless it is forcefully disabled by default using the option `{ enable: false }`.

You can give your users the option to opt in or out by calling the relevant methods. Once these have been called they are persisted and will be respected until optIn/Out is called again or the `reset` function is called.

To Opt in/out of tracking, use the following calls. 

```javascript
posthog.optIn() // opt in
posthog.optOut() // opt out
```

If you still wish capture these events but want to create a distinction between users and team in PostHog, you should look into [Cohorts](/docs/user-guides/cohorts#differentiating-team-vs-users-traffic).

### Feature Flags

Feature Flags can be loaded directly or via a helpful hook

```js
import { useFeatureFlag } from "posthog-react-native"


const MyComponent = () => {
    const showFlaggedFeature = useFeatureFlag("my-flag-id")
    const multiVariantFeature = useFeatureFlag("my-multivariant-feature-flag-id")

    if (showFlaggedFeature === undefined) {
        // the response is undefined if the flags are being loaded
        return null
    }

    return showFlaggedFeature ? (
        <Text>Testing feature ðŸ˜„</Text>
    ) : (
        <Text>Not Testing feature ðŸ˜¢</Text>
    )
}
```

Whilst the hook is active, PostHog will periodically refresh all the feature flags for the user based on the config property `{ "decidePollInterval": 30000 # every 30 seconds }`.


### Sending screen views

With the `PostHogProvider`, screen tracking is automatically captured if the `autocapture` property is used. Currently only [@react-navigation/native](https://reactnavigation.org/docs/getting-started/) is supported by autocapture and it is important that the `PostHogProvider` is configured as a child of the `NavigationContainer` as below:

See [autocapture](#autocapture) for configuration.

If you want to manually send a new screen capture event, use the `screen` function. This function requires a `name`. You may also pass in an optional `properties` object.

```javascript

posthog.screen('Dashboard', {
    background: 'blue',
    hero: 'superhog',
})
```

## Upgrading from V1 to V2

V1 of this library utilised the underlying `posthog-ios` and `posthog-android` SDKs to do most of the work. Since the new version is written entirely in JS, using only Expo supported libraries, there are some changes to the way PostHog is configured as well as actually calling PostHog.

For iOS, the new React Native SDK will attempt to migrate the previously peristed data which should result in no unexpected changes to tracked data.

For Android, it is unfortunately not possible for persisted Android data to be loaded which means stored information such as the randomly generated `anonymousId` or the `distinctId` set by `posthog.identify` will not be present. For identified users, the simple workaround is to ensure that `identify` is called at least once when the app loads. For anonymous users there is unfortunately no straightforward workaround they will show up as new anonymous users in PostHog.

```jsx
// DEPRECATED V1 Setup

import PostHog from 'posthog-react-native'

await PostHog.setup('phc_ChmcdLbC770zgl23gp3Lax6SERzC2szOUxtp0Uy4nTf', {
    host: 'https://app.posthog.com',
    captureApplicationLifecycleEvents: false, // Replaced by `PostHogProvider`
    captureDeepLinks: false, // No longer supported
    recordScreenViews: false, // Replaced by `PostHogProvider` supporting @react-navigation/native
    flushInterval: 30, // Stays the same
    flushAt: 20, // Stays the same
    android: {...}, // No longer needed
    iOS: {...}, // No longer needed
})

PostHog.capture("foo")


// V2 Setup difference
import PostHog from 'posthog-react-native'

const posthog = new PostHog('phc_ChmcdLbC770zgl23gp3Lax6SERzC2szOUxtp0Uy4nTf', {
    host: 'https://app.posthog.com',
    // Add any other options here.
})

# Use created instance rather than the PostHog class
posthog.capture("foo")
```