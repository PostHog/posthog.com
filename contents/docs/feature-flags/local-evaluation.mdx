---
title: Server-side local evaluation
sidebar: Docs
showTitle: true
availability:
    free: none
    selfServe: full
    enterprise: full
---

> **Note: Local evaluation is only available in the [Node](/docs/libraries/node), [Ruby](https://posthog.com/docs/libraries/ruby), [Go](https://posthog.com/docs/libraries/go), and [Python](https://posthog.com/docs/libraries/python) SDKs**

Evaluating feature flags requires making a request to PostHog. However, you can improve performance by evaluating a flag locally instead â€“ without having to make a request to PostHog.

We consider it best practice to use local evaluation flags where possible because this method enables you to resolve flags faster and require fewer API calls.

There are x steps to enable local evaluation:

## Step 1: Obtain a personal API key

import ObtainPersonalAPIKey from "../integrate/_snippets/obtain-personal-api-key.mdx"

<ObtainPersonalAPIKey />

## Step 2: Initialize PostHog with your personal API key

When you initialize PostHog with your personal API key, PostHog will use your the key to automatically fetch feature flag definitions. These definitions are then used to evaluate feature flags locally.

By default, PostHog fetches these definitions every 30 seconds (or 5 minutes in the Go SDK). However, you can change this frequency by specifying a different value in the polling interval argument.

> **Note:** For billing purposes, we count the request to fetch the feature flag definitions as being equivalent to 10 `decide` requests. 
> 
> This is because one of these requests can compute feature flags for hundreds or thousands of users. So this ensures local evaluation is priced fairly while remaining the most cost-effective option (by far!). 

<MultiLanguage>

```node
const client = new PostHog(
    '<ph_project_api_key>',
    { 
        host: '<ph_instance_address>',
        personalApiKey: 'your personal API key from step 1',
        featureFlagsPollingInterval: 30000 // Optional. Measured in milliseconds. Defaults to 30000 (30 seconds)
    }
) 
```

```ruby
posthog = PostHog::Client.new({
  api_key: "<ph_project_api_key>",
  host: "<ph_instance_address>",
  personal_api_key: 'your personal API key from step 1',
  feature_flags_polling_interval: 30 # Optional. Measured in seconds. Defaults to 30.
})
```

```go
package main

import (
    "os"
    "github.com/posthog/posthog-go"
)

func main() {
	client, _ := posthog.NewWithConfig(
		os.Getenv("POSTHOG_API_KEY"),
		posthog.Config{
			Endpoint:       "<ph_instance_address>",
			PersonalApiKey: "your personal API key", // needed for feature flags
            DefaultFeatureFlagsPollingInterval: 300 // Optional. Measured in seconds. Defaults to 300 (5 minutes).
		},
	)
	defer client.Close()
	// run commands
}
```

```python
PostHog::init("<ph_project_api_key>",
  array('host' => '<ph_instance_address>',
        'personal_api_key' => 'your personal API key from step 1'),
        'poll_interval' => 30 # Optional. Measured in seconds. Defaults to 30.
);
```
</MultiLanguage>

## Step 3: Evaluate your feature flag

To evaluate the feature flag, you call `getFeatureFlag` or `getAllFlags` as you normally would. However, the only difference is that you need provide any user or group properties used to evaluate the [rollout conditions](/docs/feature-flags/creating-feature-flags#release-conditions) of the flag.

Then, by default, PostHog will attempt to evaluate the flag locally. If this fails, PostHog will then make a server request fetch the flag value.

You can disable this behavior by setting `onlyEvaluateLocally` to `true`. In this case, PostHog will only attempt to evaluate the flag locally, and return `undefined` / `None` / `nil` if it was unable to.


<MultiLanguage>

```node
await client.getFeatureFlag(
    'flag-key',
    'distinct_id_of_the_user',
    {
        // include any person or group properties required to evaluate the flag
        personProperties: {'property_name': 'value'} 
        groupProperties: {'group_property_name': 'value'} 

        onlyEvaluateLocally: false, // Optional. Defaults to false. Set to true if you don't want PostHog to make a server request if it's unable to evaluate locally
    }
)
```

```ruby
posthog.get_feature_flag(
    'flag-key',
    'distinct_id_of_the_user',
    # Include any person or group properties required to evaluate the flag
    person_properties: {'property_name': 'value'} ,
    group_properties: {'group_property_name': 'value'},
    only_evaluate_locally: False # Optional. Defaults to False. Set to True if you don't want PostHog to make a server request if it's unable to evaluate locally
)
```

```go
enabledVariant, err := client.GetFeatureFlag(
        FeatureFlagPayload{
            Key:        "flag-key",
            DistinctId: "distinct_id_of_the_user",
            // Include any person or group properties required to evaluate the flag
            PersonProperties: posthog.NewProperties().
                Set("property_name", "value"),
            GroupProperties: posthog.NewProperties().
                Set("property_name", "value"),
            OnlyEvaluateLocally: false // Optional. Defaults to false. Set to true if you don't want PostHog to make a server request if it's unable to evaluate locally
        },
)
```

```python
posthog.get_feature_flag(
    'flag-key',
    'distinct_id_of_the_user',
    # Include any person or group properties required to evaluate the flag
    person_properties={'property_name': 'value'},
    group_properties={'property_name': 'value'},
    only_evaluate_locally=False # Optional. Defaults to False. Set to True if you don't want PostHog to make a server request if it's unable to evaluate locally
)
```

</MultiLanguage>